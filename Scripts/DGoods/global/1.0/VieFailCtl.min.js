/*! bate version - v1.0 - vA packaged deploy by 冯达庆 . -2016-06-15 */;define(["jquery","jquerytmpl","NavibarCtl","../utils/SysUrl","../utils/Common","../utils/ModelDailog","../utils/SysConfig","../utils/ConsumeLevel","../moduler/rs_QuotedInfo","../moduler/rs_QuoteGoods","../viewmodel/Require_QuoteViewModel","../viewmodel/QuotedInfoViewModel"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=function(b){this.LoginUser=b,this.lbTotalViedFail=a(".TotalViedFail"),this.lbStartTime=a(".LbStartTime"),this.lbSeries=a(".LbSeries"),this.lbDetail=a(".LbDetail"),this.lbMyDetail=a(".LbMyDetail"),this.lbDealPrice=a(".LbDealPrice"),this.lbDealDetail=a(".LbDealDetail"),this.lbDealPriceTitle=a(".LbDealPriceTitle"),this.lbDealPriceContent=a(".LbDealPriceContent"),this.lbPrice=a(".LbPrice"),this.lbLRCount=a(".LbRCount"),this.lbOfferCount=a(".LbOfferCount"),this.RequireDetailModel=new k,this.QuoteGoods=function(){},this.QuoteGoods.prototype=j.Req,this.QuotingModel=new l,this.QuotPageSize=window.SysInfo.Paging.DftPageSize,this.QuotPageNo=window.SysInfo.Paging.VisiblePages,this.tempPanel=a(".findD-none"),this.TmplQuoteTemplate=a("#VieFailTemplate"),this.BuyLevelMarkUp=a("#BuyLevelMarkUp"),this.QuotedPannel=a(".vien-left"),this.RightPannel=a(".vien-right"),this.BuyerLevel=a(".BuyerLevel"),this.navibar=new c(b),this.TotalViedFail=0,this.CurrentQuotingLst=[],this.CurrentQuotingID=null,this.CurrentQuoting={},this.init()};return m.prototype={init:function(){var b=this;b.CurrentQuotingLst=[],b.navibar.buildNavibar(function(c){c.LOSE>0&&0==c.STATE&&b.beginQuery(),0==c.LOSE||0!=c.STATE?b.tempPanel.css("display","block"):(b.QuotedPannel.css("display","block"),b.RightPannel.css("display","block")),b.navibar.buildScroll(),a(".TotalViedFail").first().closest("dd").addClass("active")})},bindEvent:function(){var b=this;b.QuotedPannel.find("li").unbind("click"),b.QuotedPannel.find("li").click(function(){b.QuotedPannel.find("li").removeClass("active"),a(this).addClass("active"),b.CurrentQuoting=i.Rsp,b.CurrentQuotingID=a(this).attr("data-id");for(var c=0;c<b.CurrentQuotingLst.length;c++)if(b.CurrentQuotingLst[c].REQUIREID==b.CurrentQuotingID){b.CurrentQuoting=b.CurrentQuotingLst[c];break}b.setCurrent()});var c=!1;b.TotalViedFail=parseInt(a(".TotalViedFail").last().text()),a(b.QuotedPannel).scroll(function(){if(!c&&a(b.QuotedPannel).scrollTop()>b.QuotedPannel.prop("scrollHeight")-b.QuotedPannel.height()-20&&(c=!0,b.TotalViedFail-b.CurrentQuotingLst.length>0)){var d='<li class="loadMore" style="text-align:center;position:absolute;bottom: 21px;width: 54.4%;z-index: 100;background: white;">信息加载中...</li>';a(d).insertAfter(b.QuotedPannel.find("li").last()),height=a(".loadMore").height(),a(".loadMore").fadeOut(2e3,function(){a(this).remove(),b.QuotPageNo+=1,b.beginQuery()})}})},beginQuery:function(){var a=this;a.QuotingModel.setter(a.LoginUser.DDUserId,"B",a.QuotPageNo,a.QuotPageSize),a.QuotingModel.quoteGoods(function(b){if(1==b.isSuccess&&b.Data.DATAS.length>0){for(var c=0;c<b.Data.DATAS.length;c++)b.Data.DATAS[c].ImageData={ImageLst:h(b.Data.DATAS[c].BCREDIT,!0)};b.Data.DATAS[0].ISACTIVE="active",a.CurrentQuoting=b.Data.DATAS[0],a.CurrentQuotingLst=a.CurrentQuotingLst.concat(b.Data.DATAS),a.TmplQuoteTemplate.tmpl(b.Data.DATAS).appendTo(".vien-left"),a.setCurrent(),a.beginQueryDetail(),a.bindEvent()}})},setCurrent:function(){var a=this;a.BuyerLevel.empty(),a.BuyLevelMarkUp.tmpl(a.CurrentQuoting.ImageData).appendTo(".BuyerLevel"),a.lbStartTime.text(a.CurrentQuoting.REQDATE),a.lbDealPriceTitle.text("中标价"),a.lbMyDetail.text(a.CurrentQuoting.PRICEDESC),a.lbDealPriceContent.text("￥"),a.lbDealPrice.text(""),0==a.CurrentQuoting.DEALPRICE?(a.lbDealPriceTitle.text("无中标商家"),a.lbDealPriceContent.text("")):a.lbDealPrice.text(a.CurrentQuoting.DEALPRICE),a.lbPrice.text(a.CurrentQuoting.PRICE),a.lbLRCount.text(a.CurrentQuoting.REQCOUNT),a.lbOfferCount.text(a.CurrentQuoting.OFFERS),a.lbSeries.text(a.CurrentQuoting.SERIES+"/"+a.CurrentQuoting.MATERIAL+"/"+a.CurrentQuoting.SURFACE),a.lbDetail.text(a.CurrentQuoting.DETAIL+"      交货地点:"+a.CurrentQuoting.DELIVERY),a.lbDealDetail.text(a.CurrentQuoting.DEALPRICEDESC),a.lbStartTime.text()},beginQueryDetail:function(){var a=this;a.RequireDetailModel.setter(a.LoginUser.DDUserId,a.CurrentQuoting.REQUIREID),a.RequireDetailModel.getRequireDetail(function(b){b.isSuccess&&a.lbStartTime.text(b.Data.PUBDATE)})}},m});